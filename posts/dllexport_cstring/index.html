<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#1b1b1b"><title>DLL Export 시 MFC / 표준 Windows Library 간의 CString 빌드 대한 주의점 | Narukine troubleshoot log</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=stylesheet href=/css/bundle.css><link rel=icon href=/icons/16.png sizes=16x16 type=image/png><link rel=icon href=/icons/32.png sizes=32x32 type=image/png></head><body class="body kind-page"><header class=header><a class=logo href=/>Narukine troubleshoot log</a></header><div class=primary><main class=main><div class="single block"><article class=entry><h1 class=entry__title>DLL Export 시 MFC / 표준 Windows Library 간의 CString 빌드 대한 주의점</h1><div class=entry__content><hr><p>구 버전의 호환을 위하여 MFC DLL로 작성된 클래스를 재 Wrapping 후 배포해야했다.<br>기존 라이브러리에는 <em>표준 Windows 라이브러리</em>로 설정하여 <em>공유 MFC 사용</em> 플래그를 꺼두었다. 그러나 구 버전 클래스 헤더에 <code>CString</code>을 사용하기 위하여 <code>&lt;atlstr.h></code>를 참조하여 <code>CString</code>을 사용했다. 빌드에는 이상이 없었으나, 구 프로그램에 라이브러리를 교체하고 재빌드 시에 링킹 에러가 발생했다.<br>발생 원인은 <code>CString</code> 클래스가 표준 <em>Windows 라이브러리</em>와 <em>MFC 라이브러리간</em>의 <code>StrTrait</code> 차이였다.<br><code>&lt;atlstr.h></code>를 참조하고 <code>표준 Windows 라이브러리</code>로 빌드한 결과물에서는 아래의 클래스로 빌드 되었다.</p><pre tabindex=0><code>StrTraitATL&lt;wchar_t | char | TCHAR, ChTraitsCRT&lt;wchar_t | char | TCHAR&gt;&gt;
</code></pre><p><code>&lt;afx.h></code>를 참조하고 MFC 라이브러리로 빌드한 결과물에서는 아래의 클래스로 빌드 되었다.</p><pre tabindex=0><code>StrTraitMFC&lt;wchar_t | char | TCHAR, ChTraitsCRT&lt;wchar_t | char | TCHAR&gt;&gt;
</code></pre><p>따라서 링크된 클래스가 달랐기 때문에 <em>dllimport</em>시 링크 에러가 났다.<br>위 클래스들의 타입에 따라 Multibyte(<code>char</code>), Unicode(<code>wchar_t</code>)의 구분이 같이 들어가기 때문에 결국 빌드 결과물에 <em>Multibyte/Unicode</em> 구분이 들어가게 되었으며, 기본 배포시 <em>x86/x64</em>, <em>Debug/Release</em>의 구분이 들어가서 결과적으로는 8개의 바이너리 파일이 추가로 생성되게 되었다. 그렇기 때문에 구성 관리자에서 MFC 빌드 시에만 해당 Wrapper 클래스를 참조하여 빌드 하도록 수정하여 구 버전 호환/신 버전 으로 나누어 배포하게 되었다.</p></div></article></div></main></div><footer class=footer><div class=footer__copyright>© 2022 Narukine troubleshoot log. <span class=footer__copyright-credits>Powered by <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/vimux/binario rel="nofollow noopener" target=_blank>Binario</a> theme.</span></div></footer></body></html>